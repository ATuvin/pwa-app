# PWA Приложение для расчета заработной платы - Спецификация

## 1. Основное назначение приложения

Приложение предназначено для расчета рабочих и выходных дней, отслеживания праздничных дней, расчета коэффициента выработки, расчета заработной платы на основании отработанных смен с учетом дневных/ночных и праздничных дней, а также создания различных отчетов и их сохранения/отправки.

## 2. Входные данные пользователя

### 2.1 Настройки профиля
- **ФИО** пользователя
- **Номер смены** (1, 2, 3 или 4) - для автоматического расчета рабочих и выходных дней
- **Добавление/редактирование станков** (токарные, фрезерные) - выбираются при заполнении данных о работе
- **Добавление/редактирование деталей и операций** - выбираются при заполнении данных о смене
  - *Предусмотреть возможность создания базы станков и деталей на сервере, которые администратор будет загружать в приложение*
- **Базовое время** - для расчета коэффициента выработки (с возможностью изменения для выбранного месяца в отчетах)

### 2.2 Основной блок программы (заполнение данных за рабочий день)
- **Выбор станков** - на каких станках работал в течение смены
- **Выбор деталей и операций** - какие делал операции
- **Время на выполнение операции** - вводится или редактируется при выборе операции
  - Состоит из: машинного времени + дополнительного времени (уборка станка, смена инструмента)

## 3. Графики работы (16-дневный цикл)

### Смена 1
- День 1-2: Дневная смена (08:00-20:00)
- День 3-4: Выходные
- День 5-6: Дневная смена (08:00-20:00)
- День 7-8: Выходные
- День 9-10: Ночная смена (20:00-08:00)
- День 11-12: Выходные
- День 13-14: Ночная смена (20:00-08:00)
- День 15-16: Выходные

### Смена 2
- Начинается с ночных смен (сдвиг на -8 дней от Смены 1)

### Смена 3
- Начинается в день 3 Смены 1 (первый выходной день) с дневной смены

### Смена 4
- Начинается в день 3 Смены 1 (первый выходной день) с ночной смены

### Параметры смены
- **Рабочая смена**: 12 часов минус 1 час обеда = 11 часов
- **Возможность сокращение смены**: если работник закончил раньше, это указывается в календаре и используется для расчета зарплаты
- **Подработки**: рабочие смены в выходные дни или после основной смены в один день считаются подработками и должны быть подтверждены запросом о согласии

## 4. Расчеты и коэффициенты

### 4.1 Расчетное время детали
**Расчетное время = Машинное время + Дополнительное время**

### 4.2 Коэффициент выработки

#### На уровне карточки станка за рабочую смену
```
Коэффициент = (Количество деталей на станке * Расчетное время детали) / Базовый коэффициент
```

#### На уровне карточки рабочей смены
```
Коэффициент = ((Кол-во деталей на станке 1 * Расчетное время) + 
                (Кол-во деталей на станке 2 * Расчетное время) + ...) / Базовый коэффициент
```

#### На уровне карточки месяца
```
Коэффициент = (Общее время на изготовление всех деталей за период) / 
              (Базовый коэффициент * Количество отработанных смен за период)
```

### 4.3 Дневные/ночные смены
- Коэффициенты дневных и ночных смен **одинаковые**
- Дневная смена: 08:00 - 20:00
- Ночная смена: 20:00 - 08:00

### 4.4 Праздничные дни
- **Источник**: Трудовой календарь России
- **Учет**: Увеличенная почасовая ставка применяется **только для праздничных дней, выпадающих на рабочую схему**
- Суббота и воскресенье учитываются как обычные дни
- Праздничные дни должны автоматически отмечаться в календаре

### 4.5 Формулы расчета зарплаты
*Будут указаны позже*

## 5. Функциональность отчетов

Приложение должно создавать отчеты за:
- День
- Месяц
- Выбранный период

**Возможности отчетов:**
- Изменение базового времени для выбранного месяца
- Расчет коэффициента выработки
- Расчет заработной платы с учетом всех коэффициентов

## 6. Сохранение и отправка отчетов

### Форматы
- PDF
- Excel

### Действия
- **Сохранить**: отчет сохраняется локально на устройстве
- **Отправить**: приложение предлагает одно из установленных на устройстве приложений для отправки отчета

## 7. Платформа и технические требования

### Платформа
- **PWA (Progressive Web Application)** с возможностью установки на устройство и работы офлайн
- Ориентировано на использование на **мобильных устройствах**

### Хранение данных
- **Локальное хранилище**: IndexedDB (рекомендуется для PWA приложений)
  - Поддерживает большие объемы данных
  - Асинхронный доступ
  - Индексирование для быстрого поиска
  - Работает офлайн
  - Кроссбраузерная поддержка

### История данных
- **Минимум**: за текущий год
- **Управление**: пользователь может выбрать период для удаления истории

### Функции импорта/экспорта
- Возможность экспорта всех данных из приложения
- Возможность импорта данных в приложение

### Будущие реализации
- Авторизация и синхронизация данных между устройствами
- Учет отпусков, больничных, прогулов
- Модуль создания базы станков и деталей на сервере

## 8. Структура данных

### Модели данных

#### Профиль пользователя
- ФИО
- Номер смены (1-4)
- Базовый коэффициент

#### Станок
- Название
- Тип (токарный, фрезерный)
- Описание

#### Деталь
- Название
- Описание

#### Операция
- Название
- Ссылка на деталь
- Машинное время (часы)
- Дополнительное время (часы)

#### Рабочая смена
- Дата
- Номер смены
- Тип (дневная/ночная)
- Длительность (часы)
- Является ли подработкой
- Данные о выполненных операциях на каждом станке

#### Данные о выполненной операции
- Ссылка на станок
- Ссылка на операцию
- Количество изготовленных деталей
- Фактическое время (если редактировалось)

#### Месячный отчет
- Месяц и год
- Базовый коэффициент (может отличаться от профиля)
- Список рабочих смен за месяц
- Рассчитанные коэффициенты
- Заработная плата

#### Отчет за период
- Дата начала и конца
- Базовый коэффициент
- Список рабочих смен за период
- Рассчитанные коэффициенты
- Заработная плата